# Configuraci√≥n de Proxy

Esta gu√≠a explica c√≥mo configurar un proxy en cada VM del laboratorio si tu centro educativo o empresa usa uno.

## üìã Informaci√≥n del Proxy

Antes de empezar, necesitas:
- **URL del proxy**: `http://proxy.ejemplo.com:8080`
- **Usuario** (si requiere autenticaci√≥n): `usuario`
- **Contrase√±a** (si requiere autenticaci√≥n): `password`

---

## üêß Ubuntu Server

### 1. Configurar proxy del sistema

```bash
sudo nano /etc/environment
```

A√±adir:
```bash
http_proxy="http://usuario:password@proxy.ejemplo.com:8080"
https_proxy="http://usuario:password@proxy.ejemplo.com:8080"
ftp_proxy="http://usuario:password@proxy.ejemplo.com:8080"
no_proxy="localhost,127.0.0.1,192.168.56.0/24"

HTTP_PROXY="http://usuario:password@proxy.ejemplo.com:8080"
HTTPS_PROXY="http://usuario:password@proxy.ejemplo.com:8080"
FTP_PROXY="http://usuario:password@proxy.ejemplo.com:8080"
NO_PROXY="localhost,127.0.0.1,192.168.56.0/24"
```

Aplicar:
```bash
source /etc/environment
```

### 2. Configurar APT (gestor de paquetes)

```bash
sudo nano /etc/apt/apt.conf.d/95proxies
```

A√±adir:
```
Acquire::http::Proxy "http://usuario:password@proxy.ejemplo.com:8080";
Acquire::https::Proxy "http://usuario:password@proxy.ejemplo.com:8080";
Acquire::ftp::Proxy "http://usuario:password@proxy.ejemplo.com:8080";
```

### 3. Configurar proxy para usuario espec√≠fico

```bash
nano ~/.bashrc
```

A√±adir al final:
```bash
export http_proxy="http://usuario:password@proxy.ejemplo.com:8080"
export https_proxy="http://usuario:password@proxy.ejemplo.com:8080"
export ftp_proxy="http://usuario:password@proxy.ejemplo.com:8080"
export no_proxy="localhost,127.0.0.1,192.168.56.0/24"
```

Aplicar:
```bash
source ~/.bashrc
```

### 4. Configurar MySQL (si necesita acceso externo)

```bash
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
```

No suele necesitar configuraci√≥n de proxy.

---

## ü•∑ Kali Linux

Mismo procedimiento que Ubuntu Server (es basado en Debian).

### Configuraci√≥n adicional para herramientas:

**Metasploit**:
```bash
echo "setg Proxies http:usuario:password@proxy.ejemplo.com:8080" >> ~/.msf4/msfconsole.rc
```

**Nmap** (proxy SOCKS si est√° disponible):
```bash
nmap --proxies http://usuario:password@proxy.ejemplo.com:8080 <target>
```

---

## üíæ Storage Backup (Debian)

Mismo procedimiento que Ubuntu Server.

### Configuraci√≥n adicional para Samba:

Samba no usa proxy (es protocolo local), pero si necesitas actualizaciones:

```bash
sudo nano /etc/apt/apt.conf.d/95proxies
```

A√±adir la misma configuraci√≥n que Ubuntu.

---

## ü™ü Windows Server

### 1. Configurar proxy del sistema

**PowerShell como Administrador**:
```powershell
# Configurar proxy
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings' -Name ProxyServer -Value "proxy.ejemplo.com:8080"
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings' -Name ProxyEnable -Value 1

# Excepciones (red local)
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings' -Name ProxyOverride -Value "192.168.56.*;localhost;127.0.0.1"
```

### 2. Configurar proxy con autenticaci√≥n

**GUI**:
1. Panel de Control ‚Üí Opciones de Internet
2. Conexiones ‚Üí Configuraci√≥n de LAN
3. Marcar "Usar un servidor proxy"
4. Servidor: `proxy.ejemplo.com` Puerto: `8080`
5. Avanzadas ‚Üí Excepciones: `192.168.56.*;localhost;127.0.0.1`

### 3. Configurar proxy para WinRM/PowerShell

```powershell
netsh winhttp set proxy proxy.ejemplo.com:8080 bypass-list="192.168.56.*;localhost;127.0.0.1"
```

### 4. Variables de entorno (Windows)

**PowerShell**:
```powershell
[Environment]::SetEnvironmentVariable("HTTP_PROXY", "http://usuario:password@proxy.ejemplo.com:8080", "Machine")
[Environment]::SetEnvironmentVariable("HTTPS_PROXY", "http://usuario:password@proxy.ejemplo.com:8080", "Machine")
```

---

## üíª Windows Client

Mismo procedimiento que Windows Server.

**M√©todo r√°pido con GUI**:
1. Configuraci√≥n ‚Üí Red e Internet ‚Üí Proxy
2. Configuraci√≥n manual de proxy
3. Direcci√≥n: `proxy.ejemplo.com`
4. Puerto: `8080`
5. Excepciones: `192.168.56.*;localhost;127.0.0.1`

---

## üîß Vagrant con Proxy

Si usas Vagrant detr√°s de un proxy:

### 1. Instalar plugin:
```bash
vagrant plugin install vagrant-proxyconf
```

### 2. Configurar en Vagrantfile:

```ruby
if Vagrant.has_plugin?("vagrant-proxyconf")
  config.proxy.http     = "http://usuario:password@proxy.ejemplo.com:8080"
  config.proxy.https    = "http://usuario:password@proxy.ejemplo.com:8080"
  config.proxy.no_proxy = "localhost,127.0.0.1,192.168.56.0/24"
end
```

### 3. O configurar globalmente:

```bash
export VAGRANT_HTTP_PROXY="http://usuario:password@proxy.ejemplo.com:8080"
export VAGRANT_HTTPS_PROXY="http://usuario:password@proxy.ejemplo.com:8080"
export VAGRANT_NO_PROXY="localhost,127.0.0.1,192.168.56.0/24"
```

---

## ‚úÖ Verificar Configuraci√≥n

### Linux:
```bash
# Ver variables de entorno
env | grep -i proxy

# Test de conectividad
curl -I http://www.google.com

# Test con wget
wget -O- http://www.google.com

# Ver configuraci√≥n APT
apt-config dump | grep -i proxy
```

### Windows:
```powershell
# Ver configuraci√≥n de proxy
Get-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings' | Select-Object ProxyServer, ProxyEnable

# Test de conectividad
Invoke-WebRequest -Uri "http://www.google.com"

# Ver configuraci√≥n WinRM
netsh winhttp show proxy
```

---

## üö´ Desactivar Proxy

### Linux:
```bash
# Eliminar variables de entorno
unset http_proxy https_proxy ftp_proxy

# Eliminar de archivos de configuraci√≥n
sudo rm /etc/apt/apt.conf.d/95proxies
sudo rm /etc/environment
```

### Windows:
```powershell
# Desactivar proxy
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings' -Name ProxyEnable -Value 0

# WinRM
netsh winhttp reset proxy
```

---

## üìù Excepciones Importantes

**Siempre excluir de proxy**:
- `localhost`
- `127.0.0.1`
- `192.168.56.0/24` (red del laboratorio)
- `*.local` (si usas Active Directory)

**Formato de excepciones**:
- Linux: `localhost,127.0.0.1,192.168.56.0/24`
- Windows: `192.168.56.*;localhost;127.0.0.1`

---

## üîê Seguridad

**‚ö†Ô∏è Advertencia**: Escribir credenciales en texto plano es un riesgo de seguridad.

**Alternativas m√°s seguras**:

1. **Proxy sin autenticaci√≥n** (configurar en el proxy mismo)
2. **Usar variables de sesi√≥n** en lugar de archivos permanentes
3. **Proxy transparente** (configurado a nivel de red)
4. **Kerberos/NTLM** para autenticaci√≥n Windows integrada

---

## üÜò Problemas Comunes

### Error: "407 Proxy Authentication Required"
- Verificar usuario/contrase√±a
- Verificar formato: `http://user:pass@proxy:port`
- Caracteres especiales en contrase√±a: codificar en URL

### Error: "Timeout" o "Connection refused"
- Verificar que el proxy est√° accesible: `ping proxy.ejemplo.com`
- Verificar puerto correcto
- Verificar firewall local

### Proxy funciona en navegador pero no en terminal
- Configurar variables de entorno espec√≠ficas
- Reiniciar sesi√≥n/terminal

---

## üìû Contacto

Si tu centro educativo usa proxy:
- Solicitar configuraci√≥n exacta al departamento de IT
- Preguntar si hay excepciones para laboratorios virtuales
- Solicitar documentaci√≥n espec√≠fica del proxy usado

---

**Nota**: Esta configuraci√≥n es necesaria solo si tu red requiere proxy. La mayor√≠a de redes dom√©sticas no lo necesitan.

---

**Versi√≥n**: 2.0  
**√öltima actualizaci√≥n**: Octubre 2025
