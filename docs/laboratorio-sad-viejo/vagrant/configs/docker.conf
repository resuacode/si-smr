# Configuraci√≥n de Docker para Ubuntu Server

# Archivo: /etc/docker/daemon.json

{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  },
  "storage-driver": "overlay2",
  "default-address-pools": [
    {
      "base": "172.17.0.0/16",
      "size": 24
    }
  ],
  "bip": "172.17.0.1/16",
  "fixed-cidr": "172.17.0.0/16",
  "registry-mirrors": [],
  "insecure-registries": [],
  "dns": ["8.8.8.8", "8.8.4.4"]
}

# Docker Compose para servicios del laboratorio
# Archivo: /srv/docker/docker-compose.yml

version: '3.8'

services:
  # Aplicaci√≥n web de ejemplo
  webapp:
    image: nginx:alpine
    container_name: sadlab_webapp
    ports:
      - "8080:80"
    volumes:
      - ./webapp:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    restart: unless-stopped
    networks:
      - sadlab_network

  # Base de datos adicional (PostgreSQL)
  postgres:
    image: postgres:13-alpine
    container_name: sadlab_postgres
    environment:
      POSTGRES_DB: sadlab_pg
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres123
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    restart: unless-stopped
    networks:
      - sadlab_network

  # Redis para cache
  redis:
    image: redis:alpine
    container_name: sadlab_redis
    ports:
      - "6379:6379"
    command: redis-server --requirepass redis123
    restart: unless-stopped
    networks:
      - sadlab_network

  # Portainer para gesti√≥n
  portainer:
    image: portainer/portainer-ce:latest
    container_name: sadlab_portainer
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    restart: unless-stopped
    networks:
      - sadlab_network

volumes:
  postgres_data:
  portainer_data:

networks:
  sadlab_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

# Configuraci√≥n de Nginx para webapp
# Archivo: /srv/docker/nginx.conf

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;
    
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    
    server {
        listen 80;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html index.htm;
        
        location / {
            try_files $uri $uri/ =404;
        }
        
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}

# HTML de ejemplo para webapp
# Archivo: /srv/docker/webapp/index.html

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio SAD - Aplicaci√≥n Web</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .service { margin: 20px 0; padding: 15px; background: #e9ecef; border-radius: 5px; }
        .service h3 { margin-top: 0; color: #007bff; }
        .status { padding: 5px 10px; border-radius: 3px; color: white; font-weight: bold; }
        .status.active { background: #28a745; }
        .status.inactive { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Laboratorio SAD - Aplicaci√≥n Web</h1>
        <p>Bienvenido al laboratorio de Sistemas y Administraci√≥n Distribuida</p>
        
        <div class="service">
            <h3>üìä Estado de Servicios</h3>
            <p><strong>Web Server:</strong> <span class="status active">ACTIVO</span></p>
            <p><strong>Base de Datos:</strong> <span class="status active">ACTIVO</span></p>
            <p><strong>Docker:</strong> <span class="status active">ACTIVO</span></p>
        </div>
        
        <div class="service">
            <h3>üîó Enlaces √ötiles</h3>
            <ul>
                <li><a href="/phpmyadmin" target="_blank">phpMyAdmin</a> - Gesti√≥n MySQL</li>
                <li><a href="http://192.168.56.10:9000" target="_blank">Portainer</a> - Gesti√≥n Docker</li>
                <li><a href="http://192.168.56.13" target="_blank">Storage Server</a> - Servidor de archivos</li>
                <li><a href="http://192.168.56.11" target="_blank">Windows Server</a> - Servidor Windows</li>
            </ul>
        </div>
        
        <div class="service">
            <h3>üõ†Ô∏è Informaci√≥n del Sistema</h3>
            <p><strong>Servidor:</strong> Ubuntu Server 20.04 LTS</p>
            <p><strong>IP:</strong> 192.168.56.10</p>
            <p><strong>Servicios:</strong> Apache, MySQL, Docker, SSH</p>
        </div>
    </div>
</body>
</html>